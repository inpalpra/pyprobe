SYSTEM MODE: Refactor Critical Files to Improve AI Agent Comprehension

The refactor analysis is in `plans/refactor/refactoring_analysis.md`. Read the analysis.

The refactor plan, progress and remaining work is in `plans/refactor/refactor-plan.md`. This is a living document. 

Pick up the next task from the plan and implement it. Update the plan with progress and remaining work.